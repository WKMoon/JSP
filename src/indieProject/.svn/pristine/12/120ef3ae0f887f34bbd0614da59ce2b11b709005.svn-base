<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Member">
	<select id="checkId" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<insert id="signUp" parameterType="memberVO">
		INSERT INTO MEMBER_TABLE VALUES(#{memberId}, #{memberPw}, #{memberName}, #{memberEmail}, 0, 0)
	</insert>
	
	<select id="checkEmail" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER_TABLE WHERE MEMBEREMAIL = #{memberEmail}
	</select>
	
	<select id="login" parameterType="map" resultType="_int">
		SELECT COUNT(*) FROM MEMBER_TABLE WHERE MEMBERID = #{memberId} AND MEMBERPW = #{memberPw}
	</select>
	
	<select id="getEmail" parameterType="string" resultType="string">
		SELECT MEMBEREMAIL FROM MEMBER_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="findId" parameterType="hashMap" resultType="string">
		SELECT MEMBERID FROM MEMBER_TABLE WHERE MEMBERNAME = #{memberName} AND MEMBEREMAIL = #{memberEmail}
	</select>
	
	<select id="findPw" parameterType="hashMap" resultType="_int">
		SELECT COUNT(*) FROM MEMBER_TABLE WHERE MEMBERNAME = #{memberName} AND MEMBERID = #{memberId} AND MEMBEREMAIL = #{memberEmail}
	</select>
	
	<select id="myMovieNum" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM AMAMOVIE_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="myReviewNum" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM AMAREVIEW_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="myBoardNum" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM BOARD_TABLE WHERE MEMBERID = #{memberId}	
	</select>
	
	<select id="myReplyNum" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM BOARDREPLY_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="myPopcornNum" parameterType="string" resultType="_int">
		SELECT MYPOPCORN FROM MEMBER_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="myReceivedPopcornNum" parameterType="string" resultType="_int">
		SELECT POPCORNNUM FROM MEMBER_TABLE WHERE MEMBERID = #{memberId}
	</select>
	
	<select id="myMovieList" parameterType="string" resultType="amaMovieVO">
		SELECT * FROM (SELECT * FROM AMAMOVIE_TABLE WHERE MEMBERID = #{memberId} ORDER BY AMADATE DESC) <![CDATA[WHERE ROWNUM <= 5]]>
	</select>
	
	<select id="myBoardList" parameterType="string" resultType="boardVO">
		SELECT * FROM (SELECT * FROM BOARD_TABLE WHERE MEMBERID = #{memberId} ORDER BY BOARDDATE DESC) <![CDATA[WHERE ROWNUM <= 5]]>
	</select>
	<select id="myBoardListAll" parameterType="string" resultType="boardVO">
		SELECT * FROM (SELECT * FROM BOARD_TABLE WHERE MEMBERID = #{memberId} ORDER BY BOARDDATE DESC)
	</select>
	
	<select id="myBoardReplyList" parameterType="string" resultType="boardReplyVO">
		SELECT * FROM (SELECT * FROM BOARDREPLY_TABLE WHERE MEMBERID = #{memberId} ORDER BY REPLYDATE DESC) <![CDATA[WHERE ROWNUM <= 5]]>
	</select>

	<select id="myReviewList" parameterType="string" resultType="amaMovieReviewVO">
		SELECT * FROM (SELECT AR.AMANUM, A.AMATITLEKOR, AR.REPLYCONTENT, AR.REPLYDATE FROM AMAREVIEW_TABLE AR, AMAMOVIE_TABLE A WHERE AR.MEMBERID = A.MEMBERID AND AR.MEMBERID = #{memberId} ORDER BY AR.REPLYDATE DESC) <![CDATA[WHERE ROWNUM <= 5]]>		
	</select>
	
	<select id="checkPwGetData" parameterType="hashMap" resultType="memberVO">
		SELECT * FROM MEMBER_TABLE WHERE MEMBERID = #{memberId} AND MEMBERPW = #{memberPw}
	</select>
	<select id="getMemberName" parameterType="string" resultType="string">
		SELECT MEMBERNAME FROM MEMBER_TABLE WHERE MEMBERID = #{memberId}
	</select>
	<select id="myPopcornList" parameterType="hashMap" resultType="myPagePopcornVO">
		SELECT PU.AMANUM, PU.RECEIVEID, A.AMATITLEKOR, PU.POPCORNNUM ,PU.SENDDATE FROM POPCORN_USE_TABLE PU, AMAMOVIE_TABLE A WHERE PU.SENDID = A.MEMBERID AND PU.SENDID = #{memberId} AND PU.SENDDATE BETWEEN TO_DATE(#{date1}, 'YYYY-MM-DD') AND TO_DATE(#{date2}, 'YYYY-MM-DD') AND <![CDATA[ROWNUM <= 5]]]> ORDER BY PU.SENDDATE DESC		
	</select>
	<select id="myReviewListAll" parameterType="hashMap" resultType="amaMovieReviewVO">
      SELECT * FROM
          (SELECT ROWNUM R, D.* FROM
            (SELECT * FROM AMAREVIEW_TABLE ORDER BY REPLYDATE DESC) D) B
      WHERE B.R BETWEEN #{startRow} AND #{endRow}
   </select>
</mapper>